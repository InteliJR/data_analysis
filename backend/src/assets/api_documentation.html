<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documenta√ß√£o da API - Sistema de Precifica√ß√£o</title>
    <meta name="description" content="Documenta√ß√£o completa da API para o Sistema de Gest√£o de Precifica√ß√£o, incluindo endpoints, autentica√ß√£o e regras de neg√≥cio.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìñ</text></svg>">
    <style>
      /* --- Reset e Configura√ß√£o Global --- */
      body {
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
          line-height: 1.7;
          background-color: #ffffff;
          color: #212529;
          margin: 0 auto;
          max-width: 900px; /* Limita a largura para melhor leitura */
          padding: 2rem;
      }

      /* --- Tipografia e Cabe√ßalhos --- */
      h1, h2, h3 {
          font-weight: 600;
          line-height: 1.3;
          color: #111;
          margin-top: 2.5rem;
          margin-bottom: 1rem;
      }

      h1 {
          font-size: 2.5rem;
          font-weight: 700;
          border-bottom: 2px solid #f0f0f0;
          padding-bottom: 0.5rem;
          margin-top: 0;
      }

      h2 {
          font-size: 2rem;
          border-bottom: 1px solid #eaeaea;
          padding-bottom: 0.5rem;
          margin-top: 3rem; /* Mais espa√ßo entre as se√ß√µes principais */
      }

      h3 {
          font-size: 1.5rem;
          color: #333;
          margin-top: 2rem;
      }

      p {
          margin-bottom: 1.25rem;
          font-size: 1rem;
      }

      /* --- Listas --- */
      ul, ol {
          margin-bottom: 1.25rem;
          padding-left: 2em;
      }

      li {
          margin-bottom: 0.5rem;
      }

      /* --- Blocos de C√≥digo (pre) --- */
      pre {
          background-color: #f4f7f9; /* Um cinza-azulado claro */
          border: 1px solid #e0e6ec;
          border-radius: 8px; /* Cantos arredondados modernos */
          padding: 1.25rem;
          overflow-x: auto; /* Essencial para linhas de c√≥digo longas */
          margin-bottom: 1.5rem;
          font-size: 0.9rem;
          line-height: 1.5;
      }

      pre code {
          font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
          background-color: transparent; /* O <pre> j√° tem o fundo */
          border: none;
          padding: 0;
          color: #232323; /* Texto do c√≥digo um pouco mais escuro */
      }

      /* --- C√≥digo Inline (code) --- */
      p code, li code, table code {
          font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
          background-color: #eef2f5; /* Fundo sutil */
          color: #d63384; /* Cor rosa/magenta para destaque */
          padding: 0.2em 0.4em;
          border-radius: 4px;
          font-size: 0.875em;
      }

      /* --- Destaque para M√©todos HTTP (POST, GET, etc.) --- */
      p > strong {
          color: #0056b3; /* Um azul para dar destaque */
          font-weight: 700;
      }

      /* --- Linhas Horizontais (hr) --- */
      hr {
          border: 0;
          border-top: 1px solid #e0e0e0;
          margin: 3rem 0; /* Bastante espa√ßo para separar se√ß√µes */
      }

      /* --- Tabelas --- */
      table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 1.5rem;
          font-size: 0.95rem;
      }

      th, td {
          border: 1px solid #ddd;
          padding: 0.75rem;
          text-align: left;
      }

      th {
          background-color: #f8f8f8;
          font-weight: 600;
      }

      tbody tr:nth-child(odd) {
          background-color: #fdfdfd; /* Listras sutis */
      }

      /* --- Links (se houver) --- */
      a {
          color: #007bff;
          text-decoration: none;
      }

      a:hover {
          text-decoration: underline;
      }

      /* --- Responsividade --- */
      @media (max-width: 768px) {
          body {
              padding: 1rem;
          }
          h1 { font-size: 2rem; }
          h2 { font-size: 1.75rem; }
          h3 { font-size: 1.25rem; }
          pre {
              padding: 1rem;
          }
      }
  </style>
</head>
<body>
    <h1 id="documentaocompletadaapisistemadeprecificao">Documenta√ß√£o Completa da API - Sistema de Precifica√ß√£o</h1>
<h2 id="visogeraldosistema">Vis√£o Geral do Sistema</h2>
<p>Sistema de gest√£o de precifica√ß√£o de produtos que permite gerenciar mat√©rias-primas, impostos, fretes, custos fixos e produtos finais. O sistema calcula automaticamente o pre√ßo dos produtos baseado nas mat√©rias-primas utilizadas, impostos e fretes associados.</p>
<hr />
<h2 id="autenticao">Autentica√ß√£o</h2>
<p>Todos os endpoints (exceto login e registro) requerem autentica√ß√£o via JWT Bearer Token.</p>
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
<h3 id="1registrodeusurio">1. Registro de Usu√°rio</h3>
<p><strong>POST</strong> <code>/auth/register</code></p>
<p><strong>Permiss√µes:</strong> P√∫blico (mas usu√°rio deve ser ativado por um ADMIN)</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "email": "usuario@exemplo.com",
  "name": "Nome do Usu√°rio",
  "password": "senha_segura_123",
  "role": "COMERCIAL"
}
</code></pre>
<p><strong>Response:</strong> <code>201 Created</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "email": "usuario@exemplo.com",
  "name": "Nome do Usu√°rio",
  "role": "COMERCIAL",
  "isActive": false,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z"
}
</code></pre>
<p><strong>Erros:</strong></p>
<ul>
    <li><code>400 Bad Request</code>: Dados inv√°lidos ou email j√° cadastrado</li>
    <li><code>422 Unprocessable Entity</code>: Valida√ß√£o falhou</li>
</ul>
<p><strong>Nota:</strong> </p>
<ul>
    <li>Campo <code>role</code> √© opcional. Se n√£o informado, ser√° criado com role padr√£o definido no sistema.</li>
    <li>Usu√°rio √© criado com <code>isActive: false</code> e precisa ser ativado por um ADMIN para fazer login.</li>
</ul>
<hr />
<h3 id="2login">2. Login</h3>
<p><strong>POST</strong> <code>/auth/login</code></p>
<p><strong>Permiss√µes:</strong> P√∫blico</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "email": "usuario@exemplo.com",
  "password": "senha_segura_123"
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
 "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
 "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
 "user": {
  "id": "uuid-v4",
  "email": "usuario@exemplo.com",
  "name": "Nome do Usu√°rio",
  "createdAt": "2025-10-26T10:00:00.000Z"
 }
}
</code></pre>
<p><strong>Erros:</strong></p>
<ul>
    <li><code>401 Unauthorized</code>: Credenciais inv√°lidas ou usu√°rio inativo</li>
    <li><code>400 Bad Request</code>: Dados inv√°lidos</li>
</ul>
<hr />
<h3 id="3logout">3. Logout</h3>
<p><strong>POST</strong> <code>/auth/logout</code></p>
<p><strong>Permiss√µes:</strong> Usu√°rio autenticado</p>
<p><strong>Headers:</strong></p>
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
 "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "message": "Logout realizado com sucesso"
}
</code></pre>
<hr />
<h3 id="4refreshtoken">4. Refresh Token</h3>
<p><strong>POST</strong> <code>/auth/refresh</code></p>
<p><strong>Permiss√µes:</strong> Usu√°rio autenticado</p>
<p><strong>Headers:</strong></p>
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
 "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
 "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
 "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
</code></pre>
<hr />
<h3 id="45obterperfildousurioautenticado">4.5. Obter Perfil do Usu√°rio Autenticado</h3>
<p><strong>GET</strong> <code>/auth/me</code></p>
<p><strong>Permiss√µes:</strong> Usu√°rio autenticado</p>
<p><strong>Headers:</strong></p>
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
 "id": "uuid-v4",
 "email": "usuario@exemplo.com",
 "name": "Nome do Usu√°rio",
 "role": "COMERCIAL",
 "isActive": true,
 "createdAt": "2025-10-26T10:00:00.000Z"
}
</code></pre>
<hr />
<h2 id="gestodeusurios">Gest√£o de Usu√°rios</h2>
<h3 id="5listarusurios">5. Listar Usu√°rios</h3>
<p><strong>GET</strong> <code>/users</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1
&amp;limit=10
&amp;search=nome_ou_email
&amp;role=COMERCIAL
&amp;isActive=true
&amp;sortBy=name
&amp;sortOrder=asc
</code></pre>
<p><em><strong>Nota:</strong> Usu√°rios desativados (isActive: false) n√£o conseguem fazer login, mas permanecem no sistema para preservar integridade dos logs e rela√ß√µes.</em></p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "data": [
    {
      "id": "uuid-v4",
      "email": "usuario@exemplo.com",
      "name": "Nome do Usu√°rio",
      "role": "COMERCIAL",
      "isActive": true,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z"
    }
  ],
  "meta": {
    "total": 50,
    "page": 1,
    "limit": 10,
    "totalPages": 5
  }
}
</code></pre>
<hr />
<h3 id="6obterusurioporid">6. Obter Usu√°rio por ID</h3>
<p><strong>GET</strong> <code>/users/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "email": "usuario@exemplo.com",
  "name": "Nome do Usu√°rio",
  "role": "COMERCIAL",
  "isActive": true,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z"
}
</code></pre>
<p><strong>Erros:</strong></p>
<ul>
    <li><code>404 Not Found</code>: Usu√°rio n√£o encontrado</li>
</ul>
<hr />
<h3 id="7atualizarusurio">7. Atualizar Usu√°rio</h3>
<p><strong>PATCH</strong> <code>/users/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
 "name": "Novo Nome",
 "role": "LOGISTICA",
 "isActive": false,
 "password": "nova_senha_segura_123"
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "email": "usuario@exemplo.com",
  "name": "Novo Nome",
  "role": "LOGISTICA",
  "isActive": false,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:30:00.000Z"
}
</code></pre>
<p><strong>Nota:</strong> </p>
<ul>
    <li><em>Para desativar um usu√°rio, envie <code>isActive: false</code>. Usu√°rios desativados n√£o conseguem fazer login.</em></li>
    <li><em>O campo <code>password</code> √© opcional e permite que o ADMIN redefina a senha do usu√°rio.</em></li>
    <li><em>Apenas ADMIN pode modificar <code>role</code> e <code>isActive</code>.</em></li>
</ul>
<p><strong>Nota sobre Exclus√£o de Usu√°rios:</strong> </p>
<ul>
    <li><em>N√£o √© poss√≠vel deletar usu√°rios do sistema devido √†s rela√ß√µes de auditoria (logs de altera√ß√µes em mat√©rias-primas, produtos criados, etc.). Para impedir acesso, desative o usu√°rio atrav√©s do endpoint de atualiza√ß√£o enviando <code>isActive: false</code>.</em></li>
</ul>
<hr />
<h3 id="8atualizarprprioperfil">8. Atualizar Pr√≥prio Perfil</h3>
<p><strong>PATCH</strong> <code>/users/me</code></p>
<p><strong>Permiss√µes:</strong> Usu√°rio autenticado</p>
<p><strong>Headers:</strong></p>
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
 "name": "Novo Nome",
 "password": "nova_senha_123"
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
 "id": "uuid-v4",
 "email": "usuario@exemplo.com",
 "name": "Novo Nome",
 "role": "COMERCIAL",
 "isActive": true,
 "createdAt": "2025-10-26T10:00:00.000Z",
 "updatedAt": "2025-10-26T10:30:00.000Z"
}
</code></pre>
<p><em><strong>Nota:</strong> Usu√°rios comuns s√≥ podem alterar seu pr√≥prio nome e senha. N√£o podem modificar email, role ou status.</em></p>
<hr />
<h3 id="9obterprprioperfil">9. Obter Pr√≥prio Perfil</h3>
<p><strong>GET</strong> <code>/users/me</code></p>
<p><strong>Permiss√µes:</strong> Usu√°rio autenticado</p>
<p><strong>Headers:</strong></p>
<pre><code>Authorization: Bearer &lt;token&gt;
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "email": "usuario@exemplo.com",
  "name": "Nome do Usu√°rio",
  "role": "COMERCIAL",
  "isActive": true,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z"
}
</code></pre>
<p><em>Nota: Este endpoint retorna os dados completos do usu√°rio autenticado. Diferente do /auth/me que retorna apenas informa√ß√µes b√°sicas.</em></p>
<hr />
<h2 id="impostostaxes">Impostos (Taxes)</h2>
<h3 id="9criarimposto">9. Criar Imposto</h3>
<p><strong>POST</strong> <code>/taxes</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, IMPOSTO</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "name": "Simples Nacional",
  "description": "Regime tribut√°rio simplificado",
  "items": [
    {
      "name": "PIS",
      "rate": 1.65,
      "recoverable": true
    },
    {
      "name": "COFINS",
      "rate": 7.60,
      "recoverable": true
    },
    {
      "name": "ICMS",
      "rate": 18.00,
      "recoverable": false
    }
  ]
}
</code></pre>
<p><strong>Response:</strong> <code>201 Created</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "name": "Simples Nacional",
  "description": "Regime tribut√°rio simplificado",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "taxItems": [
    {
      "id": "uuid-v4",
      "taxId": "uuid-v4",
      "name": "PIS",
      "rate": 1.65,
      "recoverable": true,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z"
    },
    {
      "id": "uuid-v4",
      "taxId": "uuid-v4",
      "name": "COFINS",
      "rate": 7.60,
      "recoverable": true,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z"
    }
  ]
}
</code></pre>
<hr />
<h3 id="10listarimpostos">10. Listar Impostos</h3>
<p><strong>GET</strong> <code>/taxes</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, IMPOSTO, COMERCIAL (para associar a mat√©rias-primas)</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1
&amp;limit=10
&amp;search=nome
&amp;sortBy=name
&amp;sortOrder=asc
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "data": [
    {
      "id": "uuid-v4",
      "name": "Simples Nacional",
      "description": "Regime tribut√°rio simplificado",
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z",
      "taxItems": [
        {
          "id": "uuid-v4",
          "name": "PIS",
          "rate": 1.65,
          "recoverable": true
        },
        {
          "id": "uuid-v4",
          "name": "COFINS",
          "rate": 7.60,
          "recoverable": true
        }
      ]
    }
  ],
  "meta": {
    "total": 5,
    "page": 1,
    "limit": 10,
    "totalPages": 1
  }
}
</code></pre>
<hr />
<h3 id="11obterimpostoporid">11. Obter Imposto por ID</h3>
<p><strong>GET</strong> <code>/taxes/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, IMPOSTO, COMERCIAL</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "name": "Simples Nacional",
  "description": "Regime tribut√°rio simplificado",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "taxItems": [
    {
      "id": "uuid-v4",
      "taxId": "uuid-v4",
      "name": "PIS",
      "rate": 1.65,
      "recoverable": true,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z"
    }
  ]
}
</code></pre>
<hr />
<h3 id="12atualizarimposto">12. Atualizar Imposto</h3>
<p><strong>PATCH</strong> <code>/taxes/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, IMPOSTO</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "name": "Simples Nacional Atualizado",
  "description": "Nova descri√ß√£o",
  "items": [
    {
      "id": "uuid-existing",
      "name": "PIS",
      "rate": 1.70,
      "recoverable": true
    },
    {
      "name": "IPI",
      "rate": 5.00,
      "recoverable": false
    }
  ]
}
</code></pre>
<p><strong>Nota:</strong> Items sem ID ser√£o criados, items com ID ser√£o atualizados, items n√£o enviados ser√£o deletados.</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "name": "Simples Nacional Atualizado",
  "description": "Nova descri√ß√£o",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:30:00.000Z",
  "taxItems": [
    {
      "id": "uuid-existing",
      "taxId": "uuid-v4",
      "name": "PIS",
      "rate": 1.70,
      "recoverable": true,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:30:00.000Z"
    },
    {
      "id": "uuid-new",
      "taxId": "uuid-v4",
      "name": "IPI",
      "rate": 5.00,
      "recoverable": false,
      "createdAt": "2025-10-26T10:30:00.000Z",
      "updatedAt": "2025-10-26T10:30:00.000Z"
    }
  ]
}
</code></pre>
<hr />
<h3 id="13deletarimposto">13. Deletar Imposto</h3>
<p><strong>DELETE</strong> <code>/taxes/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, IMPOSTO</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "message": "Imposto deletado com sucesso"
}
</code></pre>
<p><strong>Erros:</strong></p>
<ul>
    <li><code>409 Conflict</code>: Imposto est√° associado a mat√©rias-primas</li>
</ul>
<hr />
<h3 id="14exportarimpostoscsv">14. Exportar Impostos (CSV)</h3>
<p><strong>POST</strong> <code>/taxes/export</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, IMPOSTO</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "format": "csv",
  "limit": 100,
  "sortBy": "name",
  "sortOrder": "asc",
  "filters": {
    "search": "simples"
  }
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code>Content-Type: text/csv
Content-Disposition: attachment; filename="impostos-2025-10-26.csv"

ID,Nome,Descri√ß√£o,Itens,Data de Cria√ß√£o
uuid-1,Simples Nacional,Regime simplificado,"PIS (1.65%), COFINS (7.60%)",2025-10-26
</code></pre>
<hr />
<h2 id="fretesfreights">Fretes (Freights)</h2>
<h3 id="15criarfrete">15. Criar Frete</h3>
<p><strong>POST</strong> <code>/freights</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, LOGISTICA</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "name": "Transporte Rodovi√°rio SP-RJ",
  "description": "Frete rodovi√°rio com prazo de 5 dias",
  "paymentTerm": 30,
  "unitPrice": 150.00,
  "currency": "BRL",
  "additionalCosts": 25.50,
  "freightTaxes": [
    {
      "name": "ICMS",
      "rate": 12.00
    },
    {
      "name": "PIS",
      "rate": 1.65
    },
    {
      "name": "COFINS",
      "rate": 7.60
    }
  ]
}
</code></pre>
<p><strong>Response:</strong> <code>201 Created</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "name": "Transporte Rodovi√°rio SP-RJ",
  "description": "Frete rodovi√°rio com prazo de 5 dias",
  "paymentTerm": 30,
  "unitPrice": 150.00,
  "currency": "BRL",
  "additionalCosts": 25.50,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "freightTaxes": [
    {
      "id": "uuid-v4",
      "freightId": "uuid-v4",
      "name": "ICMS",
      "rate": 12.00,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z"
    }
  ]
}
</code></pre>
<hr />
<h3 id="16listarfretes">16. Listar Fretes</h3>
<p><strong>GET</strong> <code>/freights</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, LOGISTICA</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1
&amp;limit=10
&amp;search=nome_ou_descricao
&amp;currency=BRL
&amp;sortBy=name
&amp;sortOrder=asc
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "data": [
    {
      "id": "uuid-v4",
      "name": "Transporte Rodovi√°rio SP-RJ",
      "description": "Frete rodovi√°rio com prazo de 5 dias",
      "paymentTerm": 30,
      "unitPrice": 150.00,
      "currency": "BRL",
      "additionalCosts": 25.50,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z",
      "freightTaxes": [
        {
          "id": "uuid-v4",
          "name": "ICMS",
          "rate": 12.00
        }
      ]
    }
  ],
  "meta": {
    "total": 15,
    "page": 1,
    "limit": 10,
    "totalPages": 2
  }
}
</code></pre>
<hr />
<h3 id="17obterfreteporid">17. Obter Frete por ID</h3>
<p><strong>GET</strong> <code>/freights/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, LOGISTICA</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "name": "Transporte Rodovi√°rio SP-RJ",
  "description": "Frete rodovi√°rio com prazo de 5 dias",
  "paymentTerm": 30,
  "unitPrice": 150.00,
  "currency": "BRL",
  "additionalCosts": 25.50,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "freightTaxes": [
    {
      "id": "uuid-v4",
      "freightId": "uuid-v4",
      "name": "ICMS",
      "rate": 12.00,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z"
    }
  ]
}
</code></pre>
<hr />
<h3 id="18atualizarfrete">18. Atualizar Frete</h3>
<p><strong>PATCH</strong> <code>/freights/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, LOGISTICA</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "name": "Transporte Rodovi√°rio SP-RJ Atualizado",
  "unitPrice": 160.00,
  "freightTaxes": [
    {
      "id": "uuid-existing",
      "name": "ICMS",
      "rate": 13.00
    },
    {
      "name": "ISS",
      "rate": 5.00
    }
  ]
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "name": "Transporte Rodovi√°rio SP-RJ Atualizado",
  "description": "Frete rodovi√°rio com prazo de 5 dias",
  "paymentTerm": 30,
  "unitPrice": 160.00,
  "currency": "BRL",
  "additionalCosts": 25.50,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:30:00.000Z",
  "freightTaxes": [
    {
      "id": "uuid-existing",
      "freightId": "uuid-v4",
      "name": "ICMS",
      "rate": 13.00,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:30:00.000Z"
    },
    {
      "id": "uuid-new",
      "freightId": "uuid-v4",
      "name": "ISS",
      "rate": 5.00,
      "createdAt": "2025-10-26T10:30:00.000Z",
      "updatedAt": "2025-10-26T10:30:00.000Z"
    }
  ]
}
</code></pre>
<hr />
<h3 id="19deletarfrete">19. Deletar Frete</h3>
<p><strong>DELETE</strong> <code>/freights/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, LOGISTICA</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "message": "Frete deletado com sucesso"
}
</code></pre>
<p><strong>Erros:</strong></p>
<ul>
    <li><code>409 Conflict</code>: Frete est√° associado a mat√©rias-primas</li>
</ul>
<hr />
<h3 id="20exportarfretescsv">20. Exportar Fretes (CSV)</h3>
<p><strong>POST</strong> <code>/freights/export</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, LOGISTICA</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "format": "csv",
  "limit": 100,
  "sortBy": "name",
  "sortOrder": "asc",
  "filters": {
    "search": "rodovi√°rio",
    "currency": "BRL"
  }
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code>Content-Type: text/csv
Content-Disposition: attachment; filename="fretes-2025-10-26.csv"

ID,Nome,Descri√ß√£o,Prazo,Pre√ßo,Moeda,Custos Adicionais,Impostos
uuid-1,Transporte Rodovi√°rio,Frete com prazo de 5 dias,30,150.00,BRL,25.50,"ICMS (12%), PIS (1.65%)"
</code></pre>
<hr />
<h2 id="matriasprimasrawmaterials">Mat√©rias-Primas (Raw Materials)</h2>
<h3 id="21criarmatriaprima">21. Criar Mat√©ria-Prima</h3>
<p><strong>POST</strong> <code>/raw-materials</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "code": "MP-2024-001",
  "name": "Resina Poli√©ster",
  "description": "Resina de alta qualidade para lamina√ß√£o",
  "measurementUnit": "KG",
  "inputGroup": "Resinas",
  "paymentTerm": 30,
  "acquisitionPrice": 25.50,
  "currency": "BRL",
  "priceConvertedBrl": 25.50,
  "additionalCost": 2.30,
  "taxId": "uuid-tax",
  "freightId": "uuid-freight"
}
</code></pre>
<p><strong>Response:</strong> <code>201 Created</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "code": "MP-2024-001",
  "name": "Resina Poli√©ster",
  "description": "Resina de alta qualidade para lamina√ß√£o",
  "measurementUnit": "KG",
  "inputGroup": "Resinas",
  "paymentTerm": 30,
  "acquisitionPrice": 25.50,
  "currency": "BRL",
  "priceConvertedBrl": 25.50,
  "additionalCost": 2.30,
  "taxId": "uuid-tax",
  "freightId": "uuid-freight",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "tax": {
    "id": "uuid-tax",
    "name": "Simples Nacional",
    "taxItems": [
      {
        "name": "PIS",
        "rate": 1.65,
        "recoverable": true
      }
    ]
  },
  "freight": {
    "id": "uuid-freight",
    "name": "Transporte Rodovi√°rio",
    "unitPrice": 150.00,
    "freightTaxes": [
      {
        "name": "ICMS",
        "rate": 12.00
      }
    ]
  }
}
</code></pre>
<hr />
<h3 id="22listarmatriasprimas">22. Listar Mat√©rias-Primas</h3>
<p><strong>GET</strong> <code>/raw-materials</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL, IMPOSTO</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1
&amp;limit=10
&amp;search=codigo_ou_nome
&amp;measurementUnit=KG
&amp;inputGroup=Resinas
&amp;currency=BRL
&amp;sortBy=name
&amp;sortOrder=asc
&amp;includeTax=true
&amp;includeFreight=true
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "data": [
    {
      "id": "uuid-v4",
      "code": "MP-2024-001",
      "name": "Resina Poli√©ster",
      "description": "Resina de alta qualidade",
      "measurementUnit": "KG",
      "inputGroup": "Resinas",
      "paymentTerm": 30,
      "acquisitionPrice": 25.50,
      "currency": "BRL",
      "priceConvertedBrl": 25.50,
      "additionalCost": 2.30,
      "taxId": "uuid-tax",
      "freightId": "uuid-freight",
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z",
      "tax": {
        "id": "uuid-tax",
        "name": "Simples Nacional"
      },
      "freight": {
        "id": "uuid-freight",
        "name": "Transporte Rodovi√°rio"
      }
    }
  ],
  "meta": {
    "total": 150,
    "page": 1,
    "limit": 10,
    "totalPages": 15
  }
}
</code></pre>
<hr />
<h3 id="23obtermatriaprimaporid">23. Obter Mat√©ria-Prima por ID</h3>
<p><strong>GET</strong> <code>/raw-materials/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL, IMPOSTO</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?includeChangeLogs=true
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "code": "MP-2024-001",
  "name": "Resina Poli√©ster",
  "description": "Resina de alta qualidade para lamina√ß√£o",
  "measurementUnit": "KG",
  "inputGroup": "Resinas",
  "paymentTerm": 30,
  "acquisitionPrice": 25.50,
  "currency": "BRL",
  "priceConvertedBrl": 25.50,
  "additionalCost": 2.30,
  "taxId": "uuid-tax",
  "freightId": "uuid-freight",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "tax": {
    "id": "uuid-tax",
    "name": "Simples Nacional",
    "taxItems": [
      {
        "name": "PIS",
        "rate": 1.65,
        "recoverable": true
      },
      {
        "name": "COFINS",
        "rate": 7.60,
        "recoverable": true
      }
    ]
  },
  "freight": {
    "id": "uuid-freight",
    "name": "Transporte Rodovi√°rio",
    "unitPrice": 150.00,
    "currency": "BRL",
    "additionalCosts": 25.50,
    "freightTaxes": [
      {
        "name": "ICMS",
        "rate": 12.00
      }
    ]
  },
  "changeLogs": [
    {
      "id": "uuid-log",
      "field": "acquisitionPrice",
      "oldValue": "24.00",
      "newValue": "25.50",
      "changedBy": "uuid-user",
      "changedAt": "2025-10-26T10:00:00.000Z"
    }
  ]
}
</code></pre>
<hr />
<h3 id="24atualizarmatriaprima">24. Atualizar Mat√©ria-Prima</h3>
<p><strong>PATCH</strong> <code>/raw-materials/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "name": "Resina Poli√©ster Premium",
  "acquisitionPrice": 27.00,
  "taxId": "uuid-new-tax",
  "additionalCost": 3.00
}
</code></pre>
<p><strong>Nota:</strong> Todas as altera√ß√µes s√£o registradas no log de mudan√ßas automaticamente.</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "code": "MP-2024-001",
  "name": "Resina Poli√©ster Premium",
  "description": "Resina de alta qualidade para lamina√ß√£o",
  "measurementUnit": "KG",
  "inputGroup": "Resinas",
  "paymentTerm": 30,
  "acquisitionPrice": 27.00,
  "currency": "BRL",
  "priceConvertedBrl": 27.00,
  "additionalCost": 3.00,
  "taxId": "uuid-new-tax",
  "freightId": "uuid-freight",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:30:00.000Z",
  "tax": {
    "id": "uuid-new-tax",
    "name": "Lucro Real"
  },
  "freight": {
    "id": "uuid-freight",
    "name": "Transporte Rodovi√°rio"
  }
}
</code></pre>
<hr />
<h3 id="25deletarmatriaprima">25. Deletar Mat√©ria-Prima</h3>
<p><strong>DELETE</strong> <code>/raw-materials/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "message": "Mat√©ria-prima deletada com sucesso"
}
</code></pre>
<p><strong>Erros:</strong></p>
<ul>
    <li><code>409 Conflict</code>: Mat√©ria-prima est√° associada a produtos</li>
</ul>
<hr />
<h3 id="26obterlogdealteraes">26. Obter Log de Altera√ß√µes</h3>
<p><strong>GET</strong> <code>/raw-materials/:id/change-logs</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1
&amp;limit=20
&amp;field=acquisitionPrice
&amp;startDate=2025-01-01
&amp;endDate=2025-12-31
&amp;sortOrder=desc
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "data": [
    {
      "id": "uuid-log",
      "rawMaterialId": "uuid-v4",
      "field": "acquisitionPrice",
      "oldValue": "24.00",
      "newValue": "25.50",
      "changedBy": "uuid-user",
      "changedByUser": {
        "name": "Jo√£o Silva",
        "email": "joao@exemplo.com"
      },
      "changedAt": "2025-10-26T10:00:00.000Z"
    },
    {
      "id": "uuid-log-2",
      "rawMaterialId": "uuid-v4",
      "field": "taxId",
      "oldValue": "uuid-old-tax",
      "newValue": "uuid-new-tax",
      "changedBy": "uuid-user",
      "changedByUser": {
        "name": "Jo√£o Silva",
        "email": "joao@exemplo.com"
      },
      "changedAt": "2025-10-26T09:30:00.000Z"
    }
  ],
  "meta": {
    "total": 45,
    "page": 1,
    "limit": 20,
    "totalPages": 3
  }
}
</code></pre>
<hr />
<h3 id="27exportarmatriasprimascsv">27. Exportar Mat√©rias-Primas (CSV)</h3>
<p><strong>POST</strong> <code>/raw-materials/export</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "format": "csv",
  "limit": 500,
  "sortBy": "code",
  "sortOrder": "asc",
  "filters": {
    "search": "resina",
    "inputGroup": "Resinas",
    "measurementUnit": "KG"
  },
  "includeDetails": true
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code>Content-Type: text/csv
Content-Disposition: attachment; filename="materias-primas-2025-10-26.csv"

C√≥digo,Nome,Descri√ß√£o,Unidade,Grupo,Prazo Pagamento,Pre√ßo Aquisi√ß√£o,Moeda,Custo Adicional,Imposto,Frete,Data Cria√ß√£o
MP-2024-001,Resina Poli√©ster,Resina de alta qualidade,KG,Resinas,30,25.50,BRL,2.30,Simples Nacional,Transporte Rodovi√°rio,2025-10-26
</code></pre>
<hr />
<h2 id="produtosproducts">Produtos (Products)</h2>
<h3 id="28criarproduto">28. Criar Produto</h3>
<p><strong>POST</strong> <code>/products</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "code": "20462",
  "name": "Produto X",
  "description": "Descri√ß√£o do produto",
  "fixedCostId": "uuid-fixed-cost",
  "rawMaterials": [
    {
      "rawMaterialId": "uuid-rm-1",
      "quantity": 2.5
    },
    {
      "rawMaterialId": "uuid-rm-2",
      "quantity": 1.0
    }
  ]
}
</code></pre>
<p><strong>Nota:</strong> </p>
<ul>
    <li>C√≥digo deve ser num√©rico</li>
    <li>Pre√ßo √© calculado automaticamente</li>
    <li>fixedCostId √© opcional (0 ou 1)</li>
    <li>Deve ter no m√≠nimo 1 mat√©ria-prima</li>
</ul>
<p><strong>Response:</strong> <code>201 Created</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "code": "20462",
  "name": "Produto X",
  "description": "Descri√ß√£o do produto",
  "creatorId": "uuid-user",
  "fixedCostId": "uuid-fixed-cost",
  "priceWithoutTaxesAndFreight": 125.50,
  "priceWithTaxesAndFreight": 145.80,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "creator": {
    "id": "uuid-user",
    "name": "Jo√£o Silva",
    "email": "joao@exemplo.com"
  },
  "fixedCost": {
    "id": "uuid-fixed-cost",
    "description": "DESPESAS COM PESSOAL",
    "overheadPerUnit": 0.3695
  },
  "productRawMaterials": [
    {
      "rawMaterialId": "uuid-rm-1",
      "quantity": 2.5,
      "rawMaterial": {
        "id": "uuid-rm-1",
        "code": "MP-2024-001",
        "name": "Resina Poli√©ster",
        "measurementUnit": "KG",
        "acquisitionPrice": 25.50,
        "currency": "BRL"
      }
    },
    {
      "rawMaterialId": "uuid-rm-2",
      "quantity": 1.0,
      "rawMaterial": {
        "id": "uuid-rm-2",
        "code": "MP-2024-002",
        "name": "Fibra de Vidro",
        "measurementUnit": "KG",
        "acquisitionPrice": 45.00,
        "currency": "BRL"
      }
    }
  ],
  "calculations": {
    "rawMaterialsSubtotal": 108.75,
    "taxesTotal": 15.30,
    "freightTotal": 21.75,
    "priceWithoutTaxesAndFreight": 125.50,
    "priceWithTaxesAndFreight": 145.80,
    "fixedCostOverhead": 0.3695
  }
}
</code></pre>
<hr />
<h3 id="29listarprodutos">29. Listar Produtos</h3>
<p><strong>GET</strong> <code>/products</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1
&amp;limit=10
&amp;search=codigo_ou_nome
&amp;sortBy=code
&amp;sortOrder=asc
&amp;includeRawMaterials=true
&amp;includeFixedCost=true
&amp;includeCalculations=true
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "data": [
    {
      "id": "uuid-v4",
      "code": "20462",
      "name": "Produto X",
      "description": "Descri√ß√£o do produto",
      "creatorId": "uuid-user",
      "fixedCostId": "uuid-fixed-cost",
      "priceWithoutTaxesAndFreight": 125.50,
      "priceWithTaxesAndFreight": 145.80,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z",
      "creator": {
        "name": "Jo√£o Silva"
      },
      "fixedCost": {
        "description": "DESPESAS COM PESSOAL",
        "overheadPerUnit": 0.3695
      },
      "productRawMaterials": [
        {
          "quantity": 2.5,
          "rawMaterial": {
            "code": "MP-2024-001",
            "name": "Resina Poli√©ster",
            "measurementUnit": "KG"
          }
        }
      ]
    }
  ],
  "meta": {
    "total": 200,
    "page": 1,
    "limit": 10,
    "totalPages": 20
  }
}
</code></pre>
<hr />
<h3 id="30obterprodutoporid">30. Obter Produto por ID</h3>
<p><strong>GET</strong> <code>/products/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?includeRawMaterials=true
&amp;includeFixedCost=true
&amp;includeCalculations=true
&amp;includeDetailedTaxes=true
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "code": "20462",
  "name": "Produto X",
  "description": "Descri√ß√£o do produto",
  "creatorId": "uuid-user",
  "fixedCostId": "uuid-fixed-cost",
  "priceWithoutTaxesAndFreight": 125.50,
  "priceWithTaxesAndFreight": 145.80,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "creator": {
    "id": "uuid-user",
    "name": "Jo√£o Silva",
    "email": "joao@exemplo.com",
    "role": "COMERCIAL"
  },
  "fixedCost": {
    "id": "uuid-fixed-cost",
    "description": "DESPESAS COM PESSOAL",
    "code": "FC-001",
    "personnelExpenses": 53188.59,
    "generalExpenses": 49913.50,
    "proLabore": 0,
    "depreciation": 0,
    "totalCost": 103102.09,
    "considerationPercentage": 100.00,
    "salesVolume": 130000.00,
    "overheadPerUnit": 0.3695
  },
  "productRawMaterials": [
    {
      "productId": "uuid-v4",
      "rawMaterialId": "uuid-rm-1",
      "quantity": 2.5,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z",
      "rawMaterial": {
        "id": "uuid-rm-1",
        "code": "MP-2024-001",
        "name": "Resina Poli√©ster",
        "measurementUnit": "KG",
        "acquisitionPrice": 25.50,
        "currency": "BRL",
        "priceConvertedBrl": 25.50,
        "additionalCost": 2.30,
        "tax": {
          "id": "uuid-tax",
          "name": "Simples Nacional",
          "taxItems": [
            {
              "name": "PIS",
              "rate": 1.65,
              "recoverable": true
            },
            {
              "name": "COFINS",
              "rate": 7.60,
              "recoverable": true
            }
          ]
        },
        "freight": {
          "id": "uuid-freight",
          "name": "Transporte Rodovi√°rio",
          "unitPrice": 150.00,
          "currency": "BRL",
          "additionalCosts": 25.50,
          "freightTaxes": [
            {
              "name": "ICMS",
              "rate": 12.00
            }
          ]
        }
      }
    },
    {
      "productId": "uuid-v4",
      "rawMaterialId": "uuid-rm-2",
      "quantity": 1.0,
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z",
      "rawMaterial": {
        "id": "uuid-rm-2",
        "code": "MP-2024-002",
        "name": "Fibra de Vidro",
        "measurementUnit": "KG",
        "acquisitionPrice": 45.00,
        "currency": "BRL",
        "priceConvertedBrl": 45.00,
        "additionalCost": 3.50,
        "tax": {
          "id": "uuid-tax-2",
          "name": "Lucro Real",
          "taxItems": [
            {
              "name": "PIS",
              "rate": 1.65,
              "recoverable": false
            },
            {
              "name": "COFINS",
              "rate": 7.60,
              "recoverable": false
            }
          ]
        },
        "freight": {
          "id": "uuid-freight-2",
          "name": "Transporte Mar√≠timo",
          "unitPrice": 200.00,
          "currency": "USD",
          "additionalCosts": 50.00
        }
      }
    }
  ],
  "calculations": {
    "rawMaterials": [
      {
        "rawMaterialCode": "MP-2024-001",
        "rawMaterialName": "Resina Poli√©ster",
        "quantity": 2.5,
        "unitPrice": 25.50,
        "subtotal": 63.75,
        "taxes": {
          "PIS": 1.05,
          "COFINS": 4.85,
          "total": 5.90
        },
        "freight": {
          "unitPrice": 150.00,
          "quantity": 2.5,
          "subtotal": 6.25,
          "taxes": {
            "ICMS": 0.75
          }
        },
        "totalWithoutTaxesAndFreight": 63.75,
        "totalWithTaxesAndFreight": 76.65
      },
      {
        "rawMaterialCode": "MP-2024-002",
        "rawMaterialName": "Fibra de Vidro",
        "quantity": 1.0,
        "unitPrice": 45.00,
        "subtotal": 45.00,
        "taxes": {
          "PIS": 0.74,
          "COFINS": 3.42,
          "total": 4.16
        },
        "freight": {
          "unitPrice": 200.00,
          "quantity": 1.0,
          "subtotal": 5.00,
          "taxes": {}
        },
        "totalWithoutTaxesAndFreight": 45.00,
        "totalWithTaxesAndFreight": 54.16
      }
    ],
    "summary": {
      "rawMaterialsSubtotal": 108.75,
      "taxesTotal": 10.06,
      "freightTotal": 11.25,
      "additionalCostsTotal": 5.80,
      "priceWithoutTaxesAndFreight": 125.50,
      "priceWithTaxesAndFreight": 145.80,
      "fixedCostOverhead": 0.3695,
      "finalPriceWithOverhead": 146.17
    }
  }
}
</code></pre>
<hr />
<h3 id="31atualizarproduto">31. Atualizar Produto</h3>
<p><strong>PATCH</strong> <code>/products/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "name": "Produto X Atualizado",
  "description": "Nova descri√ß√£o",
  "fixedCostId": "uuid-new-fixed-cost",
  "rawMaterials": [
    {
      "rawMaterialId": "uuid-rm-1",
      "quantity": 3.0
    },
    {
      "rawMaterialId": "uuid-rm-3",
      "quantity": 0.5
    }
  ]
}
</code></pre>
<p><strong>Nota:</strong> </p>
<ul>
    <li>Ao atualizar rawMaterials, a lista enviada substitui completamente as associa√ß√µes anteriores</li>
    <li>Pre√ßos s√£o recalculados automaticamente</li>
</ul>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "code": "20462",
  "name": "Produto X Atualizado",
  "description": "Nova descri√ß√£o",
  "creatorId": "uuid-user",
  "fixedCostId": "uuid-new-fixed-cost",
  "priceWithoutTaxesAndFreight": 142.30,
  "priceWithTaxesAndFreight": 165.45,
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T11:00:00.000Z",
  "creator": {
    "name": "Jo√£o Silva"
  },
  "fixedCost": {
    "description": "GASTOS GERAIS API",
    "overheadPerUnit": 0.4200
  },
  "productRawMaterials": [
    {
      "rawMaterialId": "uuid-rm-1",
      "quantity": 3.0,
      "rawMaterial": {
        "code": "MP-2024-001",
        "name": "Resina Poli√©ster"
      }
    },
    {
      "rawMaterialId": "uuid-rm-3",
      "quantity": 0.5,
      "rawMaterial": {
        "code": "MP-2024-003",
        "name": "Catalisador"
      }
    }
  ]
}
</code></pre>
<hr />
<h3 id="32deletarproduto">32. Deletar Produto</h3>
<p><strong>DELETE</strong> <code>/products/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "message": "Produto deletado com sucesso"
}
</code></pre>
<hr />
<h3 id="33calcularpreodoprodutopreview">33. Calcular Pre√ßo do Produto (Preview)</h3>
<p><strong>POST</strong> <code>/products/calculate-price</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Nota:</strong> Este endpoint permite calcular o pre√ßo sem criar o produto (√∫til para preview na interface)</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "rawMaterials": [
    {
      "rawMaterialId": "uuid-rm-1",
      "quantity": 2.5
    },
    {
      "rawMaterialId": "uuid-rm-2",
      "quantity": 1.0
    }
  ],
  "fixedCostId": "uuid-fixed-cost"
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "calculations": {
    "rawMaterialsSubtotal": 108.75,
    "taxesTotal": 10.06,
    "freightTotal": 11.25,
    "additionalCostsTotal": 5.80,
    "priceWithoutTaxesAndFreight": 125.50,
    "priceWithTaxesAndFreight": 145.80,
    "fixedCostOverhead": 0.3695,
    "finalPriceWithOverhead": 146.17
  },
  "breakdown": [
    {
      "rawMaterialCode": "MP-2024-001",
      "rawMaterialName": "Resina Poli√©ster",
      "quantity": 2.5,
      "unitPrice": 25.50,
      "subtotal": 63.75,
      "taxes": 5.90,
      "freight": 6.25
    },
    {
      "rawMaterialCode": "MP-2024-002",
      "rawMaterialName": "Fibra de Vidro",
      "quantity": 1.0,
      "unitPrice": 45.00,
      "subtotal": 45.00,
      "taxes": 4.16,
      "freight": 5.00
    }
  ]
}
</code></pre>
<hr />
<h3 id="34exportarprodutoscsv">34. Exportar Produtos (CSV)</h3>
<p><strong>POST</strong> <code>/products/export</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "format": "csv",
  "limit": 500,
  "sortBy": "code",
  "sortOrder": "asc",
  "filters": {
    "search": "produto x"
  },
  "includeRawMaterials": true,
  "includeCalculations": true
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code>Content-Type: text/csv
Content-Disposition: attachment; filename="produtos-2025-10-26.csv"

C√≥digo,Nome,Descri√ß√£o,Grupo,Pre√ßo sem Impostos,Pre√ßo com Impostos,Moeda,Custos Adicionais,Mat√©rias-Primas,Data Cria√ß√£o
20462,Produto X,Descri√ß√£o,1,125.50,145.80,Real,4.95,"Resina Poli√©ster (2.5 KG), Fibra de Vidro (1.0 KG)",2025-10-26
</code></pre>
<hr />
<h2 id="custosfixosfixedcosts">Custos Fixos (Fixed Costs)</h2>
<h3 id="35criarcustofixo">35. Criar Custo Fixo</h3>
<p><strong>POST</strong> <code>/fixed-costs</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "description": "DESPESAS COM PESSOAL",
  "code": "FC-001",
  "personnelExpenses": 53188.59,
  "generalExpenses": 49913.50,
  "proLabore": 0,
  "depreciation": 0,
  "considerationPercentage": 100.00,
  "salesVolume": 130000.00
}
</code></pre>
<p><strong>Nota:</strong> </p>
<ul>
    <li>totalCost √© calculado automaticamente (personnelExpenses + generalExpenses + proLabore + depreciation)</li>
    <li>overheadPerUnit √© calculado automaticamente ((totalCost * considerationPercentage / 100) / salesVolume)</li>
</ul>
<p><strong>Response:</strong> <code>201 Created</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "description": "DESPESAS COM PESSOAL",
  "code": "FC-001",
  "personnelExpenses": 53188.59,
  "generalExpenses": 49913.50,
  "proLabore": 0,
  "depreciation": 0,
  "totalCost": 103102.09,
  "considerationPercentage": 100.00,
  "salesVolume": 130000.00,
  "overheadPerUnit": 0.7931,
  "calculationDate": "2025-10-26T10:00:00.000Z",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z"
}
</code></pre>
<hr />
<h3 id="36listarcustosfixos">36. Listar Custos Fixos</h3>
<p><strong>GET</strong> <code>/fixed-costs</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1
&amp;limit=10
&amp;search=descricao_ou_codigo
&amp;sortBy=calculationDate
&amp;sortOrder=desc
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "data": [
    {
      "id": "uuid-v4",
      "description": "DESPESAS COM PESSOAL",
      "code": "FC-001",
      "personnelExpenses": 53188.59,
      "generalExpenses": 49913.50,
      "proLabore": 0,
      "depreciation": 0,
      "totalCost": 103102.09,
      "considerationPercentage": 100.00,
      "salesVolume": 130000.00,
      "overheadPerUnit": 0.7931,
      "calculationDate": "2025-10-26T10:00:00.000Z",
      "createdAt": "2025-10-26T10:00:00.000Z",
      "updatedAt": "2025-10-26T10:00:00.000Z",
      "_count": {
        "products": 15
      }
    }
  ],
  "meta": {
    "total": 8,
    "page": 1,
    "limit": 10,
    "totalPages": 1
  }
}
</code></pre>
<hr />
<h3 id="37obtercustofixoporid">37. Obter Custo Fixo por ID</h3>
<p><strong>GET</strong> <code>/fixed-costs/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?includeProducts=true
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "description": "DESPESAS COM PESSOAL",
  "code": "FC-001",
  "personnelExpenses": 53188.59,
  "generalExpenses": 49913.50,
  "proLabore": 0,
  "depreciation": 0,
  "totalCost": 103102.09,
  "considerationPercentage": 100.00,
  "salesVolume": 130000.00,
  "overheadPerUnit": 0.7931,
  "calculationDate": "2025-10-26T10:00:00.000Z",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T10:00:00.000Z",
  "products": [
    {
      "id": "uuid-product-1",
      "code": "20462",
      "name": "Produto X",
      "priceWithoutTaxesAndFreight": 125.50,
      "priceWithTaxesAndFreight": 145.80
    }
  ]
}
</code></pre>
<hr />
<h3 id="38atualizarcustofixo">38. Atualizar Custo Fixo</h3>
<p><strong>PATCH</strong> <code>/fixed-costs/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "description": "DESPESAS COM PESSOAL - ATUALIZADO",
  "personnelExpenses": 55000.00,
  "salesVolume": 140000.00,
  "considerationPercentage": 95.00
}
</code></pre>
<p><strong>Nota:</strong> </p>
<ul>
    <li>totalCost e overheadPerUnit s√£o recalculados automaticamente</li>
    <li>Produtos associados ter√£o seus pre√ßos recalculados</li>
</ul>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "id": "uuid-v4",
  "description": "DESPESAS COM PESSOAL - ATUALIZADO",
  "code": "FC-001",
  "personnelExpenses": 55000.00,
  "generalExpenses": 49913.50,
  "proLabore": 0,
  "depreciation": 0,
  "totalCost": 104913.50,
  "considerationPercentage": 95.00,
  "salesVolume": 140000.00,
  "overheadPerUnit": 0.7119,
  "calculationDate": "2025-10-26T10:00:00.000Z",
  "createdAt": "2025-10-26T10:00:00.000Z",
  "updatedAt": "2025-10-26T11:00:00.000Z",
  "affectedProducts": {
    "count": 15,
    "recalculated": true
  }
}
</code></pre>
<hr />
<h3 id="39deletarcustofixo">39. Deletar Custo Fixo</h3>
<p><strong>DELETE</strong> <code>/fixed-costs/:id</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "message": "Custo fixo deletado com sucesso",
  "affectedProducts": {
    "count": 15,
    "action": "fixedCostId set to null"
  }
}
</code></pre>
<p><strong>Nota:</strong> Produtos associados ter√£o fixedCostId definido como null, mas n√£o ser√£o deletados.</p>
<hr />
<h3 id="40calcularoverheadgeraroverhead">40. Calcular Overhead (Gerar Overhead)</h3>
<p><strong>POST</strong> <code>/fixed-costs/:id/calculate-overhead</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Nota:</strong> Este endpoint permite recalcular o overhead e aplicar aos produtos sem precisar atualizar o custo fixo. √ötil para a funcionalidade "gerar overhead" mencionada nos requisitos.</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "applyToProducts": true,
  "productIds": ["uuid-product-1", "uuid-product-2"]
}
</code></pre>
<p><strong>Nota:</strong> </p>
<ul>
    <li>Se applyToProducts = true e productIds est√° vazio, aplica a todos os produtos com este fixedCostId</li>
    <li>Se applyToProducts = false, apenas retorna os c√°lculos sem aplicar</li>
</ul>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "fixedCost": {
    "id": "uuid-v4",
    "description": "DESPESAS COM PESSOAL",
    "totalCost": 103102.09,
    "overheadPerUnit": 0.7931
  },
  "affectedProducts": [
    {
      "id": "uuid-product-1",
      "code": "20462",
      "name": "Produto X",
      "priceBeforeOverhead": 145.80,
      "overheadApplied": 0.7931,
      "priceAfterOverhead": 146.59,
      "updated": true
    },
    {
      "id": "uuid-product-2",
      "code": "18933",
      "name": "Produto Y",
      "priceBeforeOverhead": 89.95,
      "overheadApplied": 0.7931,
      "priceAfterOverhead": 90.74,
      "updated": true
    }
  ],
  "summary": {
    "totalProductsAffected": 15,
    "totalOverheadDistributed": 11.90,
    "applied": true
  }
}
</code></pre>
<hr />
<h3 id="41exportarcustosfixoscsv">41. Exportar Custos Fixos (CSV)</h3>
<p><strong>POST</strong> <code>/fixed-costs/export</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "format": "csv",
  "limit": 100,
  "sortBy": "calculationDate",
  "sortOrder": "desc",
  "includeProducts": true
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code>Content-Type: text/csv
Content-Disposition: attachment; filename="custos-fixos-2025-10-26.csv"

C√≥digo,Descri√ß√£o,Pessoal,Outros,Pr√≥-Labore,Deprecia√ß√£o,Total,% Considerar,Volume Vendas,Overhead/Unidade,Produtos Associados,Data C√°lculo
FC-001,DESPESAS COM PESSOAL,53188.59,49913.50,0,0,103102.09,100%,130000.00,0.7931,15,2025-10-26
</code></pre>
<hr />
<h2 id="exportaoglobal">Exporta√ß√£o Global</h2>
<h3 id="42exportarrelatrioconsolidado">42. Exportar Relat√≥rio Consolidado</h3>
<p><strong>POST</strong> <code>/export/consolidated-report</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Request Body:</strong></p>
<pre><code class="json language-json">{
  "format": "csv",
  "includeProducts": true,
  "includeRawMaterials": true,
  "includeTaxes": true,
  "includeFreights": true,
  "includeFixedCosts": true,
  "filters": {
    "dateFrom": "2025-01-01",
    "dateTo": "2025-12-31"
  }
}
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code>Content-Type: application/zip
Content-Disposition: attachment; filename="relatorio-consolidado-2025-10-26.zip"

[ZIP contendo m√∫ltiplos arquivos CSV:]
- produtos.csv
- materias-primas.csv
- impostos.csv
- fretes.csv
- custos-fixos.csv
- resumo.csv
</code></pre>
<hr />
<h2 id="healthcheck">Health Check</h2>
<h3 id="43verificarstatusdaapi">43. Verificar Status da API</h3>
<p><strong>GET</strong> <code>/health</code></p>
<p><strong>Permiss√µes:</strong> P√∫blico</p>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "status": "ok",
  "timestamp": "2025-10-26T10:00:00.000Z",
  "uptime": 86400,
  "database": {
    "status": "connected",
    "responseTime": 5
  },
  "version": "1.0.0"
}
</code></pre>
<hr /> <h3 id="435exibirdocumentacao">43.5. Exibir Documenta√ß√£o da API</h3> <p><strong>GET</strong> <code>/docs</code></p> <p><strong>Permiss√µes:</strong> P√∫blico</p> <p><strong>Response (Success):</strong> <code>200 OK</code></p> <ul> <li>Retorna uma p√°gina <code>Content-Type: text/html</code> com a documenta√ß√£o est√°tica da API.</li> </ul> <p><strong>Response (Error):</strong> <code>404 Not Found</code></p> <pre><code class="json language-json">{ "statusCode": 404, "message": "Documentation file not found", "error": "Not Found" } </code></pre> <hr />
<h2 id="regrasdenegciodetalhadas">Regras de Neg√≥cio Detalhadas</h2>
<h3 id="clculodepreosdeprodutos">C√°lculo de Pre√ßos de Produtos</h3>
<p>O pre√ßo de um produto √© calculado seguindo estas etapas:</p>
<ol>
    <li><strong>Subtotal das Mat√©rias-Primas:</strong></li>
</ol>
<pre><code>   Para cada mat√©ria-prima:
   subtotal = quantidade √ó pre√ßo_aquisi√ß√£o_convertido_brl
</code></pre>
<ol start="2">
    <li><strong>Impostos das Mat√©rias-Primas:</strong></li>
</ol>
<pre><code>   Para cada mat√©ria-prima:
   Para cada item de imposto:
   valor_imposto = subtotal √ó (taxa / 100)

   total_impostos_materia_prima = soma de todos os impostos
</code></pre>
<ol start="3">
    <li><strong>Frete das Mat√©rias-Primas:</strong></li>
</ol>
<pre><code>   Para cada mat√©ria-prima:
   incidencia_frete = (quantidade / volume_total) √ó preco_unitario_frete

   Para cada imposto do frete:
   valor_imposto_frete = incidencia_frete √ó (taxa / 100)

   total_frete = incidencia_frete + soma_impostos_frete
</code></pre>
<ol start="4">
    <li><strong>Custos Adicionais:</strong></li>
</ol>
<pre><code>   Para cada mat√©ria-prima:
   custo_adicional_proporcional = custo_adicional √ó quantidade
</code></pre>
<ol start="5">
    <li><strong>Pre√ßo sem Impostos e Frete:</strong></li>
</ol>
<pre><code>   preco_sem_impostos_frete = soma_subtotais + soma_custos_adicionais
</code></pre>
<ol start="6">
    <li><strong>Pre√ßo com Impostos e Frete:</strong></li>
</ol>
<pre><code>   preco_com_impostos_frete = preco_sem_impostos_frete + soma_impostos + soma_fretes
</code></pre>
<ol start="7">
    <li><strong>Overhead (se houver custo fixo):</strong></li>
</ol>
<pre><code>   preco_final = preco_com_impostos_frete + overhead_por_unidade
</code></pre>
<h3 id="premissasrecuperveis">Premissas Recuper√°veis</h3>
<p>Impostos marcados como <code>recoverable: true</code> s√£o considerados premissas recuper√°veis. No c√°lculo do pre√ßo:</p>
<ul>
    <li>S√£o somados ao custo total para transpar√™ncia</li>
    <li>Mas podem ser exibidos separadamente na interface para an√°lise</li>
    <li>O sistema registra quais impostos s√£o recuper√°veis para relat√≥rios financeiros</li>
</ul>
<h3 id="controledeacessoporrearole">Controle de Acesso por √Årea (Role)</h3>
<p><strong>ADMIN:</strong></p>
<ul>
    <li>Acesso total ao sistema</li>
    <li>Gest√£o de usu√°rios</li>
    <li>Todos os recursos de COMERCIAL, LOGISTICA e IMPOSTO</li>
</ul>
<p><strong>COMERCIAL:</strong></p>
<ul>
    <li>Visualizar e gerenciar produtos</li>
    <li>Visualizar e gerenciar mat√©rias-primas</li>
    <li>Visualizar impostos (para associar a mat√©rias-primas)</li>
    <li>Visualizar fretes existentes apenas atrav√©s de autocomplete (para associar a mat√©rias-primas, sem acesso √† gest√£o completa)</li>
    <li>N√£o pode gerenciar usu√°rios, impostos ou criar/editar/deletar fretes</li>
</ul>
<p><strong>LOGISTICA:</strong></p>
<ul>
    <li>Visualizar e gerenciar fretes (CRUD completo)</li>
    <li>√önico al√©m de ADMIN que tem acesso √† gest√£o completa de fretes</li>
    <li>N√£o acessa produtos, mat√©rias-primas, impostos ou usu√°rios</li>
</ul>
<p><strong>IMPOSTO:</strong></p>
<ul>
    <li>Visualizar e gerenciar impostos (premissas)</li>
    <li>Visualizar mat√©rias-primas (para entender impacto das premissas)</li>
    <li>N√£o acessa produtos, fretes ou usu√°rios</li>
</ul>
<hr />
<h2 id="cdigosdestatushttp">C√≥digos de Status HTTP</h2>
<table>
  <thead>
    <tr>
      <th>C√≥digo</th>
      <th>Significado</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>200</td>
      <td>OK - Requisi√ß√£o bem-sucedida</td>
    </tr>
    <tr>
      <td>201</td>
      <td>Created - Recurso criado com sucesso</td>
    </tr>
    <tr>
      <td>400</td>
      <td>Bad Request - Dados inv√°lidos ou mal formatados</td>
    </tr>
    <tr>
      <td>401</td>
      <td>Unauthorized - N√£o autenticado ou token inv√°lido</td>
    </tr>
    <tr>
      <td>403</td>
      <td>Forbidden - Autenticado mas sem permiss√£o para o recurso</td>
    </tr>
    <tr>
      <td>404</td>
      <td>Not Found - Recurso n√£o encontrado</td>
    </tr>
    <tr>
      <td>409</td>
      <td>Conflict - Conflito (ex: recurso est√° sendo usado)</td>
    </tr>
    <tr>
      <td>422</td>
      <td>Unprocessable Entity - Valida√ß√£o falhou</td>
    </tr>
    <tr>
      <td>500</td>
      <td>Internal Server Error - Erro interno do servidor</td>
    </tr>
  </tbody>
</table>
<hr />
<h2 id="estruturadeerros">Estrutura de Erros</h2>
<p>Todos os erros seguem o padr√£o:</p>
<pre><code class="json language-json">{
  "statusCode": 400,
  "message": "Descri√ß√£o do erro",
  "error": "Bad Request",
  "details": [
    {
      "field": "email",
      "message": "Email j√° est√° em uso"
    }
  ],
  "timestamp": "2025-10-26T10:00:00.000Z",
  "path": "/auth/register"
}
</code></pre>
<hr />
<h2 id="paginaopadro">Pagina√ß√£o Padr√£o</h2>
<p>Todos os endpoints de listagem seguem este padr√£o:</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?page=1          // N√∫mero da p√°gina (inicia em 1)
&amp;limit=10        // Itens por p√°gina (padr√£o: 10, m√°ximo: 100)
&amp;sortBy=field    // Campo para ordena√ß√£o
&amp;sortOrder=asc   // Dire√ß√£o: asc ou desc
</code></pre>
<p><strong>Response Structure:</strong></p>
<pre><code class="json language-json">{
  "data": [...],
  "meta": {
    "total": 150,      // Total de registros
    "page": 1,         // P√°gina atual
    "limit": 10,       // Itens por p√°gina
    "totalPages": 15   // Total de p√°ginas
  }
}
</code></pre>
<hr />
<h2 id="filtrosdisponveisporrecurso">Filtros Dispon√≠veis por Recurso</h2>
<h3 id="usurios">Usu√°rios</h3>
<ul>
    <li><code>search</code>: Busca por nome ou email</li>
    <li><code>role</code>: Filtrar por role (ADMIN, COMERCIAL, LOGISTICA, IMPOSTO)</li>
    <li><code>isActive</code>: Filtrar por status (true/false)</li>
</ul>
<h3 id="impostos">Impostos</h3>
<ul>
    <li><code>search</code>: Busca por nome</li>
</ul>
<h3 id="fretes">Fretes</h3>
<ul>
    <li><code>search</code>: Busca por nome ou descri√ß√£o</li>
    <li><code>currency</code>: Filtrar por moeda (BRL, USD, EUR)</li>
</ul>
<h3 id="matriasprimas">Mat√©rias-Primas</h3>
<ul>
    <li><code>search</code>: Busca por c√≥digo ou nome</li>
    <li><code>measurementUnit</code>: Filtrar por unidade de medida</li>
    <li><code>inputGroup</code>: Filtrar por grupo de insumo</li>
    <li><code>currency</code>: Filtrar por moeda</li>
</ul>
<h3 id="produtos">Produtos</h3>
<ul>
    <li><code>search</code>: Busca por c√≥digo ou nome</li>
</ul>
<h3 id="custosfixos">Custos Fixos</h3>
<ul>
    <li><code>search</code>: Busca por descri√ß√£o ou c√≥digo</li>
</ul>
<hr />
<h2 id="ordenaodisponvelporrecurso">Ordena√ß√£o Dispon√≠vel por Recurso</h2>
<h3 id="usurios-1">Usu√°rios</h3>
<ul>
    <li><code>name</code>, <code>email</code>, <code>role</code>, <code>createdAt</code>, <code>updatedAt</code></li>
</ul>
<h3 id="impostos-1">Impostos</h3>
<ul>
    <li><code>name</code>, <code>createdAt</code>, <code>updatedAt</code></li>
</ul>
<h3 id="fretes-1">Fretes</h3>
<ul>
    <li><code>name</code>, <code>unitPrice</code>, <code>paymentTerm</code>, <code>createdAt</code>, <code>updatedAt</code></li>
</ul>
<h3 id="matriasprimas-1">Mat√©rias-Primas</h3>
<ul>
    <li><code>code</code>, <code>name</code>, <code>acquisitionPrice</code>, <code>inputGroup</code>, <code>createdAt</code>, <code>updatedAt</code></li>
</ul>
<h3 id="produtos-1">Produtos</h3>
<ul>
    <li><code>code</code>, <code>name</code>, <code>priceWithoutTaxesAndFreight</code>, <code>priceWithTaxesAndFreight</code>, <code>createdAt</code>, <code>updatedAt</code></li>
</ul>
<h3 id="custosfixos-1">Custos Fixos</h3>
<ul>
    <li><code>description</code>, <code>code</code>, <code>totalCost</code>, <code>overheadPerUnit</code>, <code>calculationDate</code>, <code>createdAt</code>, <code>updatedAt</code></li>
</ul>
<hr />
<h2 id="formatosdeexportao">Formatos de Exporta√ß√£o</h2>
<p>Todos os endpoints de exporta√ß√£o suportam:</p>
<p><strong>CSV:</strong></p>
<pre><code class="json language-json">{
  "format": "csv",
  "delimiter": ",",        // Opcional: v√≠rgula (padr√£o) ou ponto-e-v√≠rgula
  "encoding": "utf-8",     // Opcional: utf-8 (padr√£o) ou latin1
  "includeHeaders": true   // Opcional: incluir cabe√ßalhos (padr√£o: true)
}
</code></pre>
<h2 id="ratelimiting">Rate Limiting</h2>
<p>A API implementa rate limiting para proteger contra abuso:</p>
<ul>
    <li><strong>Registro:</strong> 5 tentativas por minuto</li>
    <li><strong>Login:</strong> 3 tentativas por minuto (prote√ß√£o contra brute force)</li>
    <li><strong>Refresh Token:</strong> 10 tentativas por minuto</li>
    <li><strong>Logout, Perfil (me) e endpoints gerais autenticados:</strong> Sem rate limiting (usu√°rio j√° autenticado)</li>
    <li><strong>Outros endpoints p√∫blicos:</strong> 100 requisi√ß√µes por minuto por IP</li>
    <li><strong>Exporta√ß√µes:</strong> 10 requisi√ß√µes por hora por usu√°rio</li>
</ul>
<p><strong>Headers de Rate Limit:</strong></p>
<pre><code>X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1698345600
</code></pre>
<h2 id="validaesdedados">Valida√ß√µes de Dados</h2>
<h3 id="usurios-2">Usu√°rios</h3>
<ul>
    <li><code>email</code>: Formato de email v√°lido, √∫nico no sistema, n√£o pode ser alterado ap√≥s cria√ß√£o</li>
    <li><code>password</code>: M√≠nimo 8 caracteres, sem requisitos adicionais de complexidade</li>
    <li><code>name</code>: M√≠nimo 3 caracteres, m√°ximo 100</li>
    <li><code>role</code>: Deve ser um dos valores do enum UserRole (apenas ADMIN pode alterar)</li>
    <li><code>isActive</code>: Boolean, padr√£o true (apenas ADMIN pode alterar)</li>
</ul>
<h3 id="impostos-2">Impostos</h3>
<ul>
    <li><code>name</code>: Obrigat√≥rio, m√≠nimo 3 caracteres</li>
    <li><code>taxItems.name</code>: Obrigat√≥rio</li>
    <li><code>taxItems.rate</code>: Decimal entre 0 e 100</li>
</ul>
<h3 id="fretes-2">Fretes</h3>
<ul>
    <li><code>name</code>: Obrigat√≥rio, m√≠nimo 3 caracteres</li>
    <li><code>paymentTerm</code>: Inteiro positivo (dias)</li>
    <li><code>unitPrice</code>: Decimal positivo</li>
    <li><code>currency</code>: Deve ser um dos valores do enum Currency</li>
    <li><code>freightTaxes.rate</code>: Decimal entre 0 e 100</li>
</ul>
<h3 id="matriasprimas-2">Mat√©rias-Primas</h3>
<ul>
    <li><code>code</code>: Obrigat√≥rio, √∫nico no sistema</li>
    <li><code>name</code>: Obrigat√≥rio, m√≠nimo 3 caracteres</li>
    <li><code>measurementUnit</code>: Deve ser um dos valores do enum MeasurementUnit</li>
    <li><code>paymentTerm</code>: Inteiro positivo (dias)</li>
    <li><code>acquisitionPrice</code>: Decimal positivo</li>
    <li><code>currency</code>: Deve ser um dos valores do enum Currency</li>
    <li><code>taxId</code>: UUID v√°lido, refer√™ncia existente</li>
    <li><code>freightId</code>: UUID v√°lido, refer√™ncia existente</li>
</ul>
<h3 id="produtos-2">Produtos</h3>
<ul>
    <li><code>code</code>: Obrigat√≥rio, num√©rico apenas, √∫nico no sistema</li>
    <li><code>name</code>: Obrigat√≥rio, m√≠nimo 3 caracteres</li>
    <li><code>rawMaterials</code>: Array com no m√≠nimo 1 item</li>
    <li><code>rawMaterials[].rawMaterialId</code>: UUID v√°lido, refer√™ncia existente</li>
    <li><code>rawMaterials[].quantity</code>: Decimal positivo</li>
    <li><code>fixedCostId</code>: Opcional, UUID v√°lido se fornecido</li>
</ul>
<h3 id="custosfixos-2">Custos Fixos</h3>
<ul>
    <li><code>description</code>: Obrigat√≥rio, m√≠nimo 3 caracteres</li>
    <li><code>code</code>: Opcional, √∫nico se fornecido</li>
    <li><code>personnelExpenses</code>: Decimal n√£o negativo</li>
    <li><code>generalExpenses</code>: Decimal n√£o negativo</li>
    <li><code>proLabore</code>: Decimal n√£o negativo</li>
    <li><code>depreciation</code>: Decimal n√£o negativo</li>
    <li><code>considerationPercentage</code>: Decimal entre 0 e 100</li>
    <li><code>salesVolume</code>: Decimal positivo</li>
</ul>
<hr />
<h2 id="logsdeauditoria">Logs de Auditoria</h2>
<p>O sistema registra automaticamente:</p>
<h3 id="alteraesemmatriasprimas">Altera√ß√µes em Mat√©rias-Primas</h3>
<p>Todos os campos alterados s√£o registrados em <code>RawMaterialChangeLog</code>:</p>
<ul>
    <li>Campo alterado</li>
    <li>Valor antigo</li>
    <li>Valor novo</li>
    <li>Usu√°rio que fez a altera√ß√£o</li>
    <li>Data e hora da altera√ß√£o</li>
</ul>
<hr />
<h2 id="endpointsdebuscaeautocomplete">Endpoints de Busca e Autocomplete</h2>
<p>Os endpoints de busca/autocomplete s√£o essenciais para a usabilidade do sistema. S√£o utilizados quando:</p>
<ul>
    <li>O usu√°rio precisa <strong>associar uma mat√©ria-prima a um produto</strong> e precisa buscar na lista de mat√©rias-primas dispon√≠veis</li>
    <li>Ao criar/editar uma mat√©ria-prima e precisa <strong>selecionar um imposto</strong> da lista de impostos cadastrados</li>
    <li>Ao criar/editar uma mat√©ria-prima e precisa <strong>selecionar um frete</strong> da lista de fretes cadastrados </li>
    <li>Ao criar/editar um produto e precisa <strong>selecionar um custo fixo</strong> (opcional)</li>
</ul>
<p>Estes endpoints retornam resultados filtrados rapidamente enquanto o usu√°rio digita, melhorando significativamente a experi√™ncia de uso.</p>
<h3 id="45buscarmatriasprimasautocomplete">45. Buscar Mat√©rias-Primas (Autocomplete)</h3>
<p><strong>GET</strong> <code>/raw-materials/search</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?q=resina          // Termo de busca
&amp;limit=10          // M√°ximo de resultados
&amp;fields=id,code,name,measurementUnit  // Campos a retornar
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "results": [
    {
      "id": "uuid-v4",
      "code": "MP-2024-001",
      "name": "Resina Poli√©ster",
      "measurementUnit": "KG"
    },
    {
      "id": "uuid-v5",
      "code": "MP-2024-015",
      "name": "Resina Ep√≥xi",
      "measurementUnit": "KG"
    }
  ],
  "total": 2
}
</code></pre>
<hr />
<h3 id="46buscarimpostosautocomplete">46. Buscar Impostos (Autocomplete)</h3>
<p><strong>GET</strong> <code>/taxes/search</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, IMPOSTO, COMERCIAL</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?q=simples
&amp;limit=10
&amp;fields=id,name
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "results": [
    {
      "id": "uuid-v4",
      "name": "Simples Nacional"
    }
  ],
  "total": 1
}
</code></pre>
<hr />
<h3 id="47buscarfretesautocomplete">47. Buscar Fretes (Autocomplete)</h3>
<p><strong>GET</strong> <code>/freights/search</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, LOGISTICA, COMERCIAL</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?q=rodovi√°rio
&amp;limit=10
&amp;fields=id,name,unitPrice,currency
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "results": [
    {
      "id": "uuid-v4",
      "name": "Transporte Rodovi√°rio SP-RJ",
      "unitPrice": 150.00,
      "currency": "BRL"
    }
  ],
  "total": 1
}
</code></pre>
<hr />
<h3 id="48buscarcustosfixosautocomplete">48. Buscar Custos Fixos (Autocomplete)</h3>
<p><strong>GET</strong> <code>/fixed-costs/search</code></p>
<p><strong>Permiss√µes:</strong> ADMIN, COMERCIAL</p>
<p><strong>Query Parameters:</strong></p>
<pre><code>?q=pessoal
&amp;limit=10
&amp;fields=id,description,overheadPerUnit
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "results": [
    {
      "id": "uuid-v4",
      "description": "DESPESAS COM PESSOAL",
      "overheadPerUnit": 0.7931
    }
  ],
  "total": 1
}
</code></pre>
<hr />
<h2 id="importaodedados">Importa√ß√£o de Dados</h2>
<h3 id="52importarmatriasprimascsv">52. Importar Mat√©rias-Primas (CSV)</h3>
<p><strong>POST</strong> <code>/raw-materials/import</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Content-Type:</strong> <code>multipart/form-data</code></p>
<p><strong>Form Data:</strong></p>
<pre><code>file: arquivo.csv
skipErrors: true  // Continuar mesmo se houver erros
updateExisting: false  // Atualizar registros existentes pelo c√≥digo
</code></pre>
<p><strong>Formato CSV Esperado:</strong></p>
<pre><code class="csv language-csv">code,name,description,measurementUnit,inputGroup,paymentTerm,acquisitionPrice,currency,additionalCost,taxCode,freightCode
MP-001,Resina,Descri√ß√£o,KG,Resinas,30,25.50,BRL,2.30,TAX-001,FRT-001
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "imported": 45,
  "updated": 5,
  "failed": 2,
  "errors": [
    {
      "row": 3,
      "code": "MP-003",
      "error": "Tax code TAX-999 not found"
    },
    {
      "row": 7,
      "code": "MP-007",
      "error": "Invalid measurement unit"
    }
  ]
}
</code></pre>
<hr />
<h3 id="53importarprodutoscsv">53. Importar Produtos (CSV)</h3>
<p><strong>POST</strong> <code>/products/import</code></p>
<p><strong>Permiss√µes:</strong> ADMIN</p>
<p><strong>Content-Type:</strong> <code>multipart/form-data</code></p>
<p><strong>Form Data:</strong></p>
<pre><code>file: arquivo.csv
skipErrors: true
updateExisting: false
</code></pre>
<p><strong>Formato CSV Esperado:</strong></p>
<pre><code class="csv language-csv">code,name,description,fixedCostCode,rawMaterialCode1,quantity1,rawMaterialCode2,quantity2
20462,Produto X,Descri√ß√£o,FC-001,MP-001,2.5,MP-002,1.0
</code></pre>
<p><strong>Response:</strong> <code>200 OK</code></p>
<pre><code class="json language-json">{
  "imported": 30,
  "updated": 3,
  "failed": 1,
  "errors": [
    {
      "row": 5,
      "code": "20465",
      "error": "Raw material MP-999 not found"
    }
  ]
}
</code></pre>
<hr />
<h2 id="observaesfinais">Observa√ß√µes Finais</h2>
<h3 id="performance">Performance</h3>
<ul>
    <li>Todos os endpoints de listagem suportam pagina√ß√£o</li>
    <li>√çndices criados nos campos mais consultados (c√≥digo, nome, datas)</li>
    <li>Cache pode ser implementado em endpoints de leitura frequente</li>
</ul>
<h3 id="segurana">Seguran√ßa</h3>
<ul>
    <li>Todos os endpoints (exceto login/registro) requerem JWT</li>
    <li>Senhas hasheadas com argon2</li>
    <li>Rate limiting implementado</li>
    <li>Tokens revogados s√£o armazenados e verificados</li>
    <li>CORS configurado adequadamente</li>
</ul>
<h3 id="manutenibilidade">Manutenibilidade</h3>
<ul>
    <li>Estrutura modular do NestJS</li>
    <li>DTOs para valida√ß√£o de entrada</li>
    <li>Entities para representa√ß√£o de dados</li>
    <li>Services isolados para l√≥gica de neg√≥cio</li>
    <li>Guards para controle de acesso</li>
</ul>
<h3 id="escalabilidade">Escalabilidade</h3>
<ul>
    <li>Prisma ORM para abstra√ß√£o de banco de dados</li>
    <li>Suporte a m√∫ltiplas moedas</li>
    <li>Log de altera√ß√µes para auditoria</li>
    <li>Estrutura preparada para webhooks</li>
    <li>Batch operations para opera√ß√µes em massa</li>
</ul>
<hr />
<h2 id="resumodeendpointspormdulo">Resumo de Endpoints por M√≥dulo</h2>
<table>
  <thead>
    <tr>
      <th>M√≥dulo</th>
      <th>Endpoints</th>
      <th>Permiss√µes Principais</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Auth</td>
      <td>5</td>
      <td>P√∫blico, Autenticado</td>
    </tr>
    <tr>
      <td>Users</td>
      <td>5</td>
      <td>ADMIN, Pr√≥prio usu√°rio</td>
    </tr>
    <tr>
      <td>Taxes</td>
      <td>6</td>
      <td>ADMIN, IMPOSTO</td>
    </tr>
    <tr>
      <td>Freights</td>
      <td>6</td>
      <td>ADMIN, LOGISTICA</td>
    </tr>
    <tr>
      <td>Raw Materials</td>
      <td>8</td>
      <td>ADMIN, COMERCIAL, IMPOSTO (read)</td>
    </tr>
    <tr>
      <td>Products</td>
      <td>7</td>
      <td>ADMIN, COMERCIAL</td>
    </tr>
    <tr>
      <td>Fixed Costs</td>
      <td>7</td>
      <td>ADMIN</td>
    </tr>
    <tr>
      <td>Export</td>
      <td>1</td>
      <td>ADMIN</td>
    </tr>
    <tr>
      <td>Search</td>
      <td>4</td>
      <td>Variado</td>
    </tr>
    <tr>
      <td>Import</td>
      <td>2</td>
      <td>ADMIN</td>
    </tr>
    <tr>
      <td>Health</td>
      <td>1</td>
      <td>P√∫blico</td>
    </tr>
    <tr>
      <td>Docs</td>
      <td>1</td>
      <td>P√∫blico</td>
    </tr>
  </tbody>
</table>
<p><strong>Total: 53 endpoints principais</strong></p>
</body>
</html>